<h1>Saving_against_baselines</h1>
<%=info_from_service params[:service_id]%>

<%=form_tag(saving_against_baselines_path, :method=>'get') do%>
	<%=hidden_field_tag :direction,params[:direction]%>
	<%=hidden_field_tag :sort,params[:sort]%>
	<%=hidden_field_tag :service_id,params[:service_id]%>
	<%if params[:service_id].blank?%>
		<%=render :partial=>'layouts/company_site_selection', :companies=>@companies,:sites=>@sites%>
    <%end%>
	<%=label_tag 'month'%>
	<%= date_select :month,'date', 
		{:discard_day=>true,:include_blank => true, :default => nil,:start_year=>2000}%>(Default month: Jan) <br>
	<%=submit_tag "Search"%>
<%end%>
<table class='table'>
  <thead>
    <tr>
      <th>Client name</th>
      <th>Site name</th>
      <th><%= sortable "service_id", "Service account"%></th>
      <th>Service type</th>
      <th>Service description</th>
      <th><%= sortable "month"%></th>
      <th><%= sortable "collection_saved"%></th>
      <th><%= sortable "month_saving"%></th>
      <th><%= sortable "month_extra_saving"%></th>
      <th><%= sortable "month_excluded_cost"%></th>
      <th><%= sortable "month_total_saving"%></th>
      <th><%= sortable "note"%></th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
  	<tr class='total_row'>
  		<td>Total:</td>
  		<td colspan="5"></td> 	
  		<td><%=float_pre_2 @saving_against_baselines.sum(:collection_saved)%></td> 	
  		<td><%=number_to_us_currency  @saving_against_baselines.sum(:month_saving)%></td> 	
  		<td><%=number_to_us_currency  @saving_against_baselines.sum(:month_extra_saving)%></td> 	
  		<td><%=number_to_us_currency  @saving_against_baselines.sum(:month_excluded_cost)%></td> 	
  		<td><%=number_to_us_currency  @saving_against_baselines.sum(:month_total_saving)%></td> 	
  		<td colspan="4"></td> 	
  	</tr>
    <% @saving_against_baselines.each do |saving_against_baseline| %>
      <tr>
      	<td><%=saving_against_baseline.service.site.company.client_name%></td>
      	<td><%=saving_against_baseline.service.site.site_name%></td>
      	<td><%=saving_against_baseline.service.account_number_and_name%></td>
      	<td><%=saving_against_baseline.service.service_type%></td>
      	<td><%=saving_against_baseline.service.description%></td>
        <td><%= saving_against_baseline.month.strftime("%b %Y") %></td>
        <td><%= float_pre_2 saving_against_baseline.collection_saved %></td>
        <td><%= number_to_us_currency saving_against_baseline.month_saving %></td>
        <td><%= number_to_us_currency saving_against_baseline.month_extra_saving %></td>
        <td><%= number_to_us_currency saving_against_baseline.month_excluded_cost %></td>
        <td><%= number_to_us_currency saving_against_baseline.month_total_saving %></td>
        <td><%= saving_against_baseline.note %></td>
        <td><%= link_to 'Show', saving_against_baseline_path(saving_against_baseline) %></td>
        <td><%= link_to 'Edit', edit_saving_against_baseline_path(saving_against_baseline,:service_id=>params[:service_id]) %></td>
        <td><%= link_to 'Destroy', saving_against_baseline, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br><%=will_paginate @saving_against_baselines%> <br>
<%unless params[:service_id].blank?%>
	<%= link_to 'New Saving against baseline', new_saving_against_baseline_path(:service_id=>params[:service_id]) %>
	| <%= link_to 'Back', services_path%>
<%end%>
